<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>JET FIGHTER - HATEM WAR PRO</title>
    <script src="https://telegram.org/js/games.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000b1a; touch-action: none; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        canvas { display: block; }
        
        /* واجهة المستخدم المحترفة */
        #hud {
            position: absolute; top: 15px; left: 15px; color: #00f2ff;
            background: rgba(0, 20, 40, 0.8); padding: 15px; border-radius: 12px;
            border: 2px solid #00f2ff; pointer-events: none; box-shadow: 0 0 20px #00f2ff;
        }
        
        /* الخريطة فوق على اليمين */
        #minimap-container {
            position: absolute; top: 15px; right: 15px; width: 120px; height: 120px;
            background: rgba(0, 40, 0, 0.6); border: 2px solid #00ff00; border-radius: 10px;
        }

        /* أزرار التحكم */
        .game-btn {
            position: absolute; width: 80px; height: 80px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            color: white; font-weight: bold; font-size: 14px; cursor: pointer;
            user-select: none; border: 3px solid rgba(255,255,255,0.5);
        }
        #fire-btn { bottom: 40px; right: 40px; background: radial-gradient(#ff0000, #990000); box-shadow: 0 0 20px #ff0000; }
        #shop-btn { bottom: 40px; right: 140px; background: radial-gradient(#ffaa00, #b87b00); box-shadow: 0 0 20px #ffaa00; }

        /* قايمة المتجر */
        #shop-menu {
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 80%; background: rgba(0, 20, 40, 0.95); border: 3px solid #00f2ff;
            border-radius: 20px; padding: 20px; color: white; text-align: center; z-index: 100;
        }
        .shop-item { background: rgba(0, 242, 255, 0.2); padding: 10px; margin: 10px; border-radius: 10px; border: 1px solid #00f2ff; cursor: pointer; }
    </style>
</head>
<body>

<div id="hud">
    <div style="font-size: 1.2em; border-bottom: 1px solid #00f2ff; padding-bottom: 5px;">HATEM WAR PRO</div>
    <div style="margin-top: 8px;">SCORE: <span id="score" style="color: yellow;">0</span></div>
    <div style="font-size: 0.8em; color: #00ff00;">PLAYERS ONLINE: <span id="online-count">14</span></div>
</div>

<div id="minimap-container">
    <canvas id="minimapCanvas"></canvas>
</div>

<div id="fire-btn" class="game-btn">FIRE</div>
<div id="shop-btn" class="game-btn">SHOP</div>

<div id="shop-menu">
    <h2>WAR SHOP</h2>
    <div class="shop-item" onclick="upgradeWeapon()">Double Cannon (Cost: 500)</div>
    <div class="shop-item" onclick="upgradeSpeed()">Extra Thrust (Cost: 300)</div>
    <div class="shop-item" onclick="closeShop()" style="background: #900;">CLOSE</div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const WORLD_SIZE = 10000;
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mCanvas = document.getElementById('minimapCanvas');
const mCtx = mCanvas.getContext('2d');

let w, h;
const player = { x: WORLD_SIZE/2, y: WORLD_SIZE/2, angle: 0, speed: 0, maxSpeed: 16, score: 0, weaponLevel: 1 };
let ammos = [], bullets = [], enemies = [];
const joy = { active: false, x: 0, y: 0, currX: 0, currY: 0, r: 70 };

const jetImg = new Image(); jetImg.src = 'https://raw.githubusercontent.com/Almasi/Gaze/master/assets/images/ship.png';
const bgImg = new Image(); bgImg.src = 'https://raw.githubusercontent.com/Almasi/Gaze/master/assets/images/starfield.png';

function init() {
    resize();
    for(let i=0; i<200; i++) ammos.push({ x: Math.random()*WORLD_SIZE, y: Math.random()*WORLD_SIZE });
    for(let i=0; i<15; i++) enemies.push({ x: Math.random()*WORLD_SIZE, y: Math.random()*WORLD_SIZE, angle: Math.random()*Math.PI*2 });
    requestAnimationFrame(loop);
}

function resize() {
    w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight;
    mCanvas.width = 120; mCanvas.height = 120;
}

// أزرار التحكم
document.getElementById('fire-btn').addEventListener('touchstart', shoot);
document.getElementById('shop-btn').addEventListener('touchstart', () => { document.getElementById('shop-menu').style.display = 'block'; });

function closeShop() { document.getElementById('shop-menu').style.display = 'none'; }
function upgradeWeapon() { if(player.score >= 500) { player.score -= 500; player.weaponLevel = 2; updateScore(); closeShop(); } }
function updateScore() { document.getElementById('score').innerText = player.score; }

function shoot() {
    bullets.push({ x: player.x, y: player.y, angle: player.angle, life: 60 });
}

// التحكم بالحركة
window.addEventListener('touchstart', e => {
    const t = e.touches[0];
    if(t.clientX < w/2) { joy.active = true; joy.x = t.clientX; joy.y = t.clientY; joy.currX = t.clientX; joy.currY = t.clientY; }
});

window.addEventListener('touchmove', e => {
    if(!joy.active) return;
    const t = e.touches[0];
    const dx = t.clientX - joy.x; const dy = t.clientY - joy.y;
    const angle = Math.atan2(dy, dx);
    const dist = Math.min(Math.sqrt(dx*dx + dy*dy), joy.r);
    joy.currX = joy.x + Math.cos(angle) * dist;
    joy.currY = joy.y + Math.sin(angle) * dist;
    player.angle = angle; player.speed = (dist/joy.r) * player.maxSpeed;
});

window.addEventListener('touchend', () => { joy.active = false; player.speed *= 0.92; });

function drawPlayer() {
    ctx.save();
    ctx.translate(w/2, h/2); ctx.rotate(player.angle + Math.PI/2);
    if(player.speed > 2) {
        ctx.fillStyle = '#44ccff'; ctx.shadowBlur = 25; ctx.shadowColor = '#00f2ff';
        ctx.beginPath(); ctx.moveTo(-8, 20); ctx.lineTo(0, 50 + Math.random()*20); ctx.lineTo(8, 20); ctx.fill();
    }
    ctx.drawImage(jetImg, -35, -35, 70, 70);
    ctx.restore();
}

function update() {
    player.x += Math.cos(player.angle) * player.speed;
    player.y += Math.sin(player.angle) * player.speed;
    player.x = Math.max(0, Math.min(WORLD_SIZE, player.x));
    player.y = Math.max(0, Math.min(WORLD_SIZE, player.y));

    // تحديث الطلقات
    bullets.forEach((b, i) => {
        b.x += Math.cos(b.angle) * 25; b.y += Math.sin(b.angle) * 25; b.life--;
        if(b.life <= 0) bullets.splice(i, 1);
    });

    // جمع الذخيرة
    ammos = ammos.filter(a => {
        if(Math.sqrt((player.x-a.x)**2 + (player.y-a.y)**2) < 50) {
            player.score += 10; updateScore(); return false;
        }
        return true;
    });
}

function draw() {
    ctx.fillStyle = '#000510'; ctx.fillRect(0,0,w,h);
    
    // الخلفية
    ctx.save(); ctx.globalAlpha = 0.5;
    let bgX = (-(player.x * 0.3) % w); let bgY = (-(player.y * 0.3) % h);
    for(let i=-1; i<=1; i++) for(let j=-1; j<=1; j++) ctx.drawImage(bgImg, bgX + i*w, bgY + j*h, w, h);
    ctx.restore();

    ctx.save(); ctx.translate(w/2 - player.x, h/2 - player.y);
    
    // رسم الطلقات
    bullets.forEach(b => {
        ctx.fillStyle = '#00f2ff'; ctx.shadowBlur = 10; ctx.shadowColor = '#00f2ff';
        ctx.beginPath(); ctx.arc(b.x, b.y, 4, 0, Math.PI*2); ctx.fill();
    });

    // رسم الذخيرة
    ammos.forEach(a => {
        ctx.fillStyle = '#ffff00'; ctx.beginPath(); ctx.arc(a.x, a.y, 8, 0, Math.PI*2); ctx.fill();
    });

    // رسم الأعداء
    enemies.forEach(e => {
        ctx.fillStyle = 'red'; ctx.beginPath(); ctx.arc(e.x, e.y, 15, 0, Math.PI*2); ctx.fill();
    });

    ctx.restore();
    drawPlayer();

    if(joy.active) {
        ctx.strokeStyle = 'rgba(0, 242, 255, 0.2)'; ctx.beginPath(); ctx.arc(joy.x, joy.y, joy.r, 0, Math.PI*2); ctx.stroke();
        ctx.fillStyle = 'rgba(0, 242, 255, 0.4)'; ctx.beginPath(); ctx.arc(joy.currX, joy.currY, 25, 0, Math.PI*2); ctx.fill();
    }
    drawMinimap();
}

function drawMinimap() {
    mCtx.clearRect(0,0,120,120);
    const s = 120/WORLD_SIZE;
    mCtx.fillStyle = '#00ff00'; mCtx.beginPath(); mCtx.arc(player.x*s, player.y*s, 4, 0, Math.PI*2); mCtx.fill();
    mCtx.fillStyle = 'red'; enemies.forEach(e => mCtx.fillRect(e.x*s, e.y*s, 2, 2));
}

function loop() { update(); draw(); requestAnimationFrame(loop); }
init();
window.addEventListener('resize', resize);
</script>
</body>
</html>
